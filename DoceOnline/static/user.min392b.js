(function(){var EMPTY,is_different,translation_component_cache,hasProp={}.hasOwnProperty,slice=[].slice;if(window.R){return}EMPTY={};is_different=function(a,b){var key;for(key in a){if(!hasProp.call(a,key))continue;if(a[key]!==b[key]){return true}}for(key in b){if(!hasProp.call(b,key))continue;if(!(key in a)){return true}}return false};translation_component_cache={};window.R=function(name,data,p,prefix){var cl,class_name,default_props,factory,prop_types;if(p==null){p=R}if(prefix==null){prefix=""}if(p[name]){return p[name]._class}data.trigger=function(){var node;node=$(ReactDOM.findDOMNode(this));R.trigger.apply(R,[node].concat(slice.call(arguments)));return void 0};data.dispatch=function(){var node;node=$(ReactDOM.findDOMNode(this));R.dispatch.apply(R,[node].concat(slice.call(arguments)));return void 0};data.container=function(){return $(ReactDOM.findDOMNode(this))};data.extend_props=function(){var more;more=1<=arguments.length?slice.call(arguments,0):[];return $.extend.apply($,[{},this.props].concat(slice.call(more)))};data.tt=function(key,props){var text;if(props==null){props=EMPTY}if(text=I.i18n.fetch_key_sync(key)){if(_.isString(text)){return text}}translation_component_cache[key]||(translation_component_cache[key]=I.i18n.react_class(key));return React.createElement(translation_component_cache[key],props)};data.t=function(key,variables){if(I.i18n.fetch_key_sync(key)){return I.i18n.t_sync(key,variables)}else{I.i18n.fetch_key(key).done(function(_this){return function(){if(_this.isMounted()){return _this.forceUpdate()}}}(this));return"…"}};class_name=_.once(function(){return(""+prefix+name).replace(/[A-Z]/g,"_$&").replace(/\./g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").toLowerCase()+"_widget"});data.enclosing_class_name=class_name;data.enclose=function(){var args,component,props;props=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[];component=props.component||"div";delete props.component;return React.createElement.apply(React,[component,$.extend({},props,{className:classNames(class_name(),props.className)})].concat(slice.call(args)))};data.displayName=""+prefix+name;if(data.pure){data.shouldComponentUpdate=function(nextProps,nextState){return is_different(this.props||EMPTY,nextProps)||is_different(this.state||EMPTY,nextState)}}default_props=data.getDefaultProps;delete data.getDefaultProps;prop_types=data.propTypes;delete data.propTypes;cl=createReactClass(data);if(default_props){cl.defaultProps=default_props()}if(prop_types){cl.propTypes=prop_types}factory=React.createElement.bind(null,cl);factory.type=cl;return p[name]=factory};R.scope_event_name=function(name){return"itch:"+name};R.trigger=function(){var args,name,node;node=arguments[0],name=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];return node.trigger(R.scope_event_name(name),slice.call(args))};R.dispatch=function(node,prefix,event_table){var event_name,fn,results;if(typeof prefix==="object"){event_table=prefix;prefix=false}results=[];for(event_name in event_table){if(!hasProp.call(event_table,event_name))continue;fn=event_table[event_name];if(prefix){event_name=prefix+":"+event_name}results.push(node.on(R.scope_event_name(event_name),fn))}return results};R.component=function(){return R.apply(null,arguments)};R.is_different=is_different;R["package"]=function(_this){return function(prefix){var p;p=R[prefix]||(R[prefix]=function(name,data){data.Package=p;return R.component(name,data,p,prefix+".")});p.component=function(){return p.apply(null,arguments)};return p}}(this)}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,c,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;if(R.Redactor){return}c=function(_this){return function(){return R.component.apply(R,arguments)}}(this);types=PropTypes;c("Redactor",{pure:true,componentDidMount:function(){var opts;opts=$.extend({minHeight:80,source:false},this.props.redactor_opts);opts.callbacks||(opts.callbacks={});opts.callbacks.change=function(_this){return function(html){var base;if(typeof(base=_this.props).on_change==="function"){base.on_change(html)}if(_this.props.remember_key){_this.set_memory||(_this.set_memory=_.throttle(function(html){return I.store_memory(this.remember_key(),html)},500));return _this.set_memory(html)}}}(this);return I.redactor($(ReactDOM.findDOMNode(this)),opts)},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return I.clear_memory(this.remember_key())},get_default_value:function(){var v;if(v=this.props.defaultValue){return v}if(this.props.remember_key){if(v=typeof localStorage!=="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0){return v}}},render:function(){return textarea({name:this.props.name,value:this.props.value,defaultValue:this.get_default_value(),placeholder:this.props.placeholder,required:this.props.required,autoFocus:this.props.autofocus})}});c("CSRF",{pure:true,render:function(){return input({type:"hidden",name:"csrf_token",value:$("meta[name=csrf_token]").attr("value")})}});R.DownTickIcon=React.createElement("svg",{className:"svgicon icon_down_tick2",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"22",height:"22",strokeLinejoin:"round","aria-hidden":true,fill:"none"},React.createElement("polyline",{points:"6 9 12 15 18 9"}));P=R["package"]("Forms");P("TextInputRow",{pure:true,propTypes:{title:types.string,sub:types.any,name:types.string.isRequired,value:types.any},focus:function(){return this.input_ref.current.focus()},get_input_el:function(){return this.input_ref.current},get_value:function(){return this.input_ref.current.value},componentDidMount:function(){var valid_slug_chars;if(this.props.money_input){if(!this.props.currency){throw new Error("missing currency")}I.money_input(this.input_ref.current,{currency:this.props.currency})}if(this.props.slug_input){I.slug_input($(this.input_ref.current))}if(this.props.integer_input){valid_slug_chars=/[0-9]/g;return $(this.input_ref.current).on("keypress",function(_this){return function(e){var char;if(e.keyCode>=32){char=String.fromCharCode(e.keyCode);if(!char.match(valid_slug_chars)){return false}}}}(this))}},render:function(){var inside;inside=[div({className:"label",key:"label"},this.props.title,this.props.sub?span({className:"sub"}," — ",this.props.sub):void 0),input({type:"text",key:"input",name:this.props.name,ref:this.input_ref||(this.input_ref=React.createRef()),value:this.props.value,defaultValue:this.props.defaultValue,onChange:this.props.onChange,onKeyUp:this.props.onKeyUp,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onClick:this.props.onClick,readOnly:this.props.readonly,className:classNames({has_error:this.props.has_error}),required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern}),this.props.error_message?p({key:"error",className:"input_error"},this.props.error_message):void 0];if(!this.props.multi){inside=label({children:inside})}return div({className:classNames("input_row",this.props.className)},inside)}});P("SimpleSelect",{pure:true,propTypes:{options:types.array.isRequired,name:types.string},getInitialState:function(){return{value:this.props.defaultValue?this.props.defaultValue:void 0}},render:function(){var children,current,current_group,push_group,render_current_option;current=this.current_option();render_current_option=this.props.render_current_option;render_current_option||(render_current_option=function(_this){return function(current){return current.short_name||current.name}}(this));children=[];current_group=null;push_group=function(){if(!current_group){return}children.push(optgroup.apply(null,[{label:current_group.label,key:"group-"+children.length}].concat(slice.call(current_group.children))));return current_group=null};this.props.options.map(function(_this){return function(o,idx){var opt;opt=option({key:""+idx,value:o.value},o.name);if(o.group){if((current_group!=null?current_group.label:void 0)!==o.group){push_group()}current_group||(current_group={label:o.group,children:[]});return current_group.children.push(opt)}else{push_group();return children.push(opt)}}}(this));push_group();return this.enclose({className:classNames({focused:this.state.focused,disabled:this.props.disabled,has_value:current!==this.props.options[0]})},div({className:"selected_option"},span({className:"selected_option_name"},render_current_option(current)),R.DownTickIcon),select({disabled:this.props.disabled,value:current.value,name:this.props.name,onFocus:function(_this){return function(e){return _this.setState({focused:true})}}(this),onBlur:function(_this){return function(e){return _this.setState({focused:false})}}(this),onChange:this.on_change,children:children}))},on_change:function(e){var value;value=e.target.value;if(this.props.onChange){if(value===this.props.value){return}return this.props.onChange(value)}else{if(value===this.state.value){return}return this.setState({value:value})}},find_option:function(value){var j,len,opt,ref;ref=this.props.options;for(j=0,len=ref.length;j<len;j++){opt=ref[j];if(opt.value===value){return opt}}},current_option:function(){var current,search_value;search_value=this.props.value||this.state.value;current=search_value!=null?this.find_option(search_value):void 0;return current||this.props.options[0]}});P("Select",{propTypes:{name:types.string.isRequired,value:types.any,options:types.array.isRequired},componentDidMount:function(){var el,opts;if(!this.props.selectize){return}opts=this.props.selectize===true?{}:this.props.selectize;el=$(this.refs.input);el.selectize(opts);if(this.props.onChange){return el.on("change",function(_this){return function(e){return _this.props.onChange(e)}}(this))}},render:function(){return select({ref:"input",name:this.props.name,onChange:this.props.onChange,value:this.props.value,defaultValue:this.props.defaultValue,children:this.props.options.map(function(_this){return function(arg){var label,value;value=arg[0],label=arg[1];return option({key:value,value:value},label||value)}}(this))})}});P("RadioButtons",{propTypes:{name:types.string.isRequired,value:types.any,options:types.array.isRequired},getValue:function(){var j,len,name,ref,ref1,value;ref=this.container().find("input").serializeArray();for(j=0,len=ref.length;j<len;j++){ref1=ref[j],name=ref1.name,value=ref1.value;return value}},render:function(){return ul({className:"radio_list",children:this.props.options.map(function(_this){return function(arg,idx){var input_label,more_opts,sub,value;value=arg[0],input_label=arg[1],sub=arg[2],more_opts=arg[3];return li({key:value!=null?value:idx,className:classNames({disabled:more_opts!=null?more_opts.disabled:void 0})},label({},input($.extend({type:"radio",name:_this.props.name,value:value,defaultChecked:_this.props.defaultValue?value===_this.props.defaultValue:void 0,checked:_this.props.value!=null?value===_this.props.value:void 0,onChange:_this.props.onChange},more_opts)),span({className:"radio_label"},input_label),sub?span({className:"sub"}," — ",sub):void 0))}}(this))})}});P("Slider",{pure:true,propTypes:{min:types.number,max:types.number,value:types.number,onChange:types.func,disabled:types.bool},getInitialState:function(){return{}},on_change:function(value){value=Math.round(value);if(this.props.onChange){if(this.props.value===value){return}return this.props.onChange(value)}else{if(this.state.value===value){return}return this.setState({value:value})}},start_drag:function(start_x,start_y){var move_listener,start_value,up_listener,width;if(this.props.disabled){return}width=this.refs.track.clientWidth;start_value=this.current_value();this.setState({dragging:true});move_listener=function(_this){return function(e){var dx,new_value,x,y;e.preventDefault();if(e.buttons===0){up_listener();return}x=e.pageX;y=e.pageX;dx=x-start_x;new_value=dx/width*(_this.props.max-_this.props.min)+start_value;new_value=Math.min(_this.props.max,Math.max(_this.props.min,new_value));if(new_value!==_this.current_value()){return _this.on_change(new_value)}}}(this);up_listener=function(_this){return function(e){if(e!=null){e.preventDefault()}_this.setState({dragging:false});document.body.removeEventListener("mousemove",move_listener);document.body.removeEventListener("mouseup",up_listener);return delete _this.up_listener}}(this);document.body.addEventListener("mousemove",move_listener);document.body.addEventListener("mouseup",up_listener);return this.up_listener=up_listener},current_value:function(){if("value"in this.state){return this.state.value||this.props.min}else{return this.props.value||this.props.min}},percent:function(){return(this.current_value()-this.props.min)/(this.props.max-this.props.min)},componentWillUnmount:function(){if(this.up_listener){return this.up_listener()}},render:function(){var offset_style;offset_style={left:this.percent()*100+"%"};return this.enclose({className:classNames("slider_input",{disabled:this.props.disabled}),onClick:function(_this){return function(e){var new_value,rect;if(e.target===_this.refs.slider_nub){return}rect=_this.refs.track.getBoundingClientRect();p=Math.min(rect.width,Math.max(0,e.pageX-rect.left))/rect.width;new_value=_this.props.min+p*(_this.props.max-_this.props.min);new_value=Math.min(_this.props.max,Math.max(_this.props.min,new_value));if(new_value!==_this.current_value()){return _this.on_change(new_value)}}}(this)},this.props.name?input({type:"hidden",name:this.props.name,value:this.current_value()}):void 0,div({ref:"track",className:"slider_track"},div({className:"slider_fill",style:{width:this.percent()*100+"%"}}),this.state.focused&&this.props.show_tooltip?div({style:offset_style,className:"value_tooltip"},this.current_value()):void 0,button({type:"button",ref:"slider_nub",className:"slider_nub",onFocus:function(_this){return function(){return _this.setState({focused:true})}}(this),onBlur:function(_this){return function(){return _this.setState({focused:false})}}(this),onMouseDown:function(_this){return function(e){return _this.start_drag(e.pageX,e.pageY)}}(this),onKeyDown:function(_this){return function(e){switch(e.keyCode){case 37:_this.on_change(Math.max(_this.props.min,_this.current_value()-1));break;case 39:_this.on_change(Math.min(_this.props.max,_this.current_value()+1));break;default:return}return e.preventDefault()}}(this),style:offset_style})))}});P("FilterPicker",{pure:true,componentWillUnmount:function(){return $(window).off("click",this.window_click_listener)},getDefaultProps:function(){return{label_padding:3}},getInitialState:function(){return{open:false}},close_picker:function(){if(!this.state.open){return}this.setState({open:false,popup_visible:false});return $(window).off("click",this.window_click_listener)},open_picker:function(){var el,rect;el=this.open_button_ref.current;rect=el.getBoundingClientRect();if(this.window_click_listener){$(window).off("click",this.window_click_listener)}this.window_click_listener=function(_this){return function(e){c=$(e.target).closest(_this.container());if(c.length){return}return _this.close_picker()}}(this);$(window).on("click",this.window_click_listener);return this.setState({open:true,top:-this.props.label_padding,left:-this.props.label_padding,height:rect.height+this.props.label_padding*2},function(_this){return function(){_this.filter_popup_ref.current.focus();return _.defer(function(){if(_this.window_click_listener&&_this.state.open){return _this.setState({popup_visible:true})}})}}(this))},render:function(){return this.enclose({className:classNames("filter_picker_widget",{open:this.state.open,popup_visible:this.state.popup_visible}),onKeyDown:this.state.open?function(_this){return function(e){if(e.keyCode===27){return _this.close_picker()}}}(this):void 0},button({type:"button",className:"filter_value",ref:this.open_button_ref||(this.open_button_ref=React.createRef()),onClick:this.state.open?this.close_picker:this.open_picker},span({className:"value_label"},this.props.label),R.DownTickIcon),div({tabIndex:-1,ref:this.filter_popup_ref||(this.filter_popup_ref=React.createRef()),className:"filter_popup",style:{top:(this.state.top||0)+"px",left:(this.state.left||0)+"px"}},div({style:{marginTop:(this.state.height||0)+"px"},className:"filter_options"},this.props.render_children?this.state.open?this.props.render_children():void 0:this.props.children)))}});P("StarPicker",{getDefaultProps:function(){return{total_stars:5,star_filled:"icon-star",star_empty:"icon-star2"}},getInitialState:function(){return{}},set_value:function(value){if(this.props.set_value){return this.props.set_value(value)}else{return this.setState({value:value})}},render:function(){var display_value,i,ref,ref1,ref2,stars,value;value=(ref=(ref1=(ref2=this.props.value)!=null?ref2:this.state.value)!=null?ref1:this.props.defaultValue)!=null?ref:0;display_value=this.state.preview_value||value;stars=function(){var j,ref3,results;results=[];for(i=j=1,ref3=this.props.total_stars;1<=ref3?j<=ref3:j>=ref3;i=1<=ref3?++j:--j){results.push(function(_this){return function(i){var cls;cls=i>display_value?"star icon "+_this.props.star_empty:"star icon "+_this.props.star_filled;return button({key:"star-"+i,type:"button",title:i+" Star"+(i===1?"":"s"),onMouseEnter:function(){return _this.setState({preview_value:i})},onMouseLeave:function(){return _this.setState({preview_value:null})},onClick:function(){return _this.set_value(i)}},span({className:cls}))}}(this)(i))}return results}.call(this);return this.enclose({className:classNames(this.props.className,{interactive:true,previewing:this.state.preview_value!=null,has_value:value>0})},this.props.name?input({type:"hidden",name:this.props.name,value:value>0?value:""}):void 0,stars)}});P("EditableInput",{getInitialState:function(){return{value:null,edit_value:null}},componentDidUpdate:function(prev_props){var value;value=this.state.value?this.state.value:this.props.value;if(this.props.value===value){return}return this.setState({value:this.props.value,edit_value:null})},confirm_edit:function(){if(!this.state.edit_value){return}return this.setValue(this.state.edit_value)},cancel_edit:function(){return this.setState({edit_value:null})},setValue:function(value){var base;this.setState({value:value,edit_value:null});return typeof(base=this.props).onUpdate==="function"?base.onUpdate(value):void 0},render:function(){var ref;return input({type:(ref=this.props.type)!=null?ref:"text",className:this.props.className,name:this.props.name,title:this.props.title,readOnly:this.props.readonly,required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern,value:this.state.edit_value!==null?this.state.edit_value:this.state.value!==null?this.state.value:this.props.value,onKeyDown:function(_this){return function(e){if(e.keyCode===27){_this.cancel_edit();e.stopPropagation()}if(e.keyCode===13){_this.confirm_edit();return e.stopPropagation()}}}(this),onFocus:function(_this){return function(e){return e.target.select()}}(this),onBlur:function(_this){return function(e){return _this.confirm_edit()}}(this),onChange:function(_this){return function(e){return _this.setState({edit_value:e.target.value})}}(this)})}});P("FocusButton",{pure:true,getInitialState:function(){return{focused:false}},componentWillUnmount:function(){var base;if(this.state.focused){return typeof(base=this.props).on_decrement_focus==="function"?base.on_decrement_focus():void 0}},on_focus:function(){var base;this.setState({focused:true});return typeof(base=this.props).on_increment_focus==="function"?base.on_increment_focus():void 0},on_blur:function(){var base;this.setState({focused:false});return typeof(base=this.props).on_decrement_focus==="function"?base.on_decrement_focus():void 0},render:function(){var props;props=$.extend({onFocus:this.on_focus,onBlur:this.on_blur},this.props);delete props.on_increment_focus;delete props.on_decrement_focus;return button(props)}});P("FormErrors",{pure:true,getDefaultProps:function(){return{animated:true,scroll_into_view:true}},propTypes:{title:types.string,errors:types.array.isRequired},render:function(){var el;el=function(){if(this.props.animated){if(!R.SlideDown){throw new Error("Attempted to render animated errors without R.SlideDown")}return R.SlideDown}else{return section}}.call(this);return el({className:classNames(this.enclosing_class_name(),"form_errors"),role:"alert"},div({ref:this.props.scroll_into_view?function(el){if(el){return typeof el.scrollIntoView==="function"?el.scrollIntoView():void 0}}:void 0},p({},strong({},this.props.title||this.tt("misc.forms.form_errors"))),ul({},this.props.errors.map(function(_this){return function(e){var text;text=e==="recaptcha"?"Please complete the CAPTCHA to continue":e;return li({key:e},text)}}(this))),this.props.children))}});P("RecaptchaInput",{propTypes:{sitekey:types.string.isRequired},componentDidMount:function(){return I.with_recaptcha(function(_this){return function(){var el;I.event("recaptcha","show",I.page_name());el=ReactDOM.findDOMNode(_this);return grecaptcha.render(el,{sitekey:_this.props.sitekey})}}(this))},render:function(){return div({className:"g-recaptcha"})}})})}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.UserHeader=function(superClass){extend(UserHeader,superClass);function UserHeader(){UserHeader.__super__.constructor.apply(this,arguments);this.el.dispatch("click",{edit_theme_btn:function(_this){return function(){return _this.toggle_theme_editor()}}(this)});if(window.location.hash.match(/\bedit_theme\b/)){_.defer(function(_this){return function(){return _this.toggle_theme_editor()}}(this))}}UserHeader.prototype.toggle_theme_editor=function(){var new_open;new_open=!I.theme_editor.state.open;I.theme_editor.setState({open:new_open});return $(document.body).toggleClass("theme_editor_open",new_open)};return UserHeader}(I.Header)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.UserPage=function(){UserPage.prototype.sticky_selector=".profile_column, .game_column";function UserPage(el,opts){this.opts=opts;this.el=$(el);this.setup_grid();this.setup_tracking();if(this.opts.ac){I.setup_affiliate_code(this.opts.ac)}}UserPage.prototype.setup_grid=function(){var lists;this.grid=new I.GameGrid(this.el.find(".user_game_grid"),{selector:".mode_grid .user_game_grid .game_cell .game_thumb",width_selector:".mode_grid .user_game_grid .game_cell",show_popups:false});lists=$(".purchased_games, .collections");lists.lazy_images({});return new I.GameCells(lists)};UserPage.prototype.setup_tracking=function(){I.setup_grid_referrers(this.el,function(_this){return function(){return"user:"+_this.opts.user_id}}(this));return I.tracked_links(this.el,"user")};return UserPage}();I.UserToolProfilePage=function(superClass){extend(UserToolProfilePage,superClass);function UserToolProfilePage(){UserToolProfilePage.__super__.constructor.apply(this,arguments);this.game_cells=this.grid.el.find(".game_cell");this.render_tool_tag_filter();this.render_grouped_games()}UserToolProfilePage.prototype.setup_grid=function(){return this.grid=new I.GameGrid(this.el.find(".user_game_grid"),{selector:".user_game_grid .game_cell .game_thumb",width_selector:".user_game_grid .game_cell",expected_size:280})};UserToolProfilePage.prototype.render_grouped_games=function(){var game,games,group,i,id,len,ref,results,seen_games;this.grid.el.empty();seen_games={};ref=this.opts.default_groups;results=[];for(i=0,len=ref.length;i<len;i++){group=ref[i];games=this.find_games_by_filter(group.filter);if(!games.length){continue}games=function(){var j,len1,results1;results1=[];for(j=0,len1=games.length;j<len1;j++){game=games[j];id=$(game).data("game_id");if(seen_games[id]){continue}seen_games[id]=true;results1.push(game)}return results1}();games=$(games);this.grid.el.append($("<h2></h2>").text(group.title));results.push(games.appendTo(this.grid.el))}return results};UserToolProfilePage.prototype.render_filtered_games=function(filter){this.grid.el.empty();return this.find_games_by_filter(filter).appendTo(this.grid.el)};UserToolProfilePage.prototype.find_games_by_filter=function(filter){var cell,found_count,key,out,tag_id,total_filters;total_filters=function(){var results;results=[];for(key in filter){if(!hasProp.call(filter,key))continue;results.push(key)}return results}().length;out=function(){var i,j,len,len1,ref,ref1,results;ref=this.game_cells;results=[];for(i=0,len=ref.length;i<len;i++){cell=ref[i];cell=$(cell);found_count=0;ref1=cell.data("tags")||[];for(j=0,len1=ref1.length;j<len1;j++){tag_id=ref1[j];if(filter[tag_id]){found_count+=1}}if(found_count===total_filters){results.push(cell[0])}else{continue}}return results}.call(this);return $(out)};UserToolProfilePage.prototype.render_tool_tag_filter=function(){var drop;drop=this.el.find(".tool_tags_filter_drop");return ReactDOM.render(R.User.ToolTags($.extend({on_select_tags:function(_this){return function(tags){if($.isEmptyObject(tags)){return _this.render_grouped_games()}else{return _this.render_filtered_games(tags)}}}(this)},this.opts.tool_tags_props)),drop[0])};return UserToolProfilePage}(I.UserPage)}).call(this);(function(){I.UserUserTools=function(){function UserUserTools(el){this.el=$(el);I.tracked_links(this.el,"view_user","user_tools");I.has_follow_button(this.el);setTimeout(function(_this){return function(){return _this.el.removeClass("hidden")}}(this),200)}return UserUserTools}();I.UserLayout=function(){function UserLayout(el){this.el=$(el);new I.UserUserTools(this.el.find(".user_tools"))}return UserLayout}()}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createElement.bind(null,React.Fragment);fragment.type=React.fragment;P=R["package"]("User");types=PropTypes;P("GameGrid",{render:function(){return this.enclose({className:["game_grid_widget","user_game_grid"],children:this.props.games.map(function(_this){return function(game){return _this.render_game(game)}}(this))})},render_game:function(game){var thumb_style;thumb_style={backgroundColor:game.bg_color,backgroundImage:game.cover_image_url&&"url("+game.cover_image_url+")"};return div({className:classNames("game_cell",{has_cover:game.cover_image_url}),key:game.url},a({href:game.url,className:"thumb_link","data-label":"game:"+game.id+":thumb","data-action":"game_grid"},div({className:"game_thumb",style:thumb_style})),div({className:"game_cell_data"},div({className:"game_title"},a({href:game.url,className:"title","data-label":"game:"+game.id+":title","data-action":"game-grid"},game.title))))}});P("ToolTags",{getInitialState:function(){return{selected_tags:$.extend({},this.props.default_tags)}},componentDidMount:function(){},tags_by_id:function(){if(this._tags_by_id){return this._tags_by_id}this._tags_by_id={};this.props.tag_groups.forEach(function(_this){return function(group){return group.tags.forEach(function(tag){tag.group=group;return _this._tags_by_id[""+tag.id]=tag})}}(this));return this._tags_by_id},select_tag:function(id){var base,i,len,other_tag,ref,selected_tags,tag;selected_tags=$.extend({},this.state.selected_tags);tag=this.tags_by_id()[id];ref=tag.group.tags;for(i=0,len=ref.length;i<len;i++){other_tag=ref[i];delete selected_tags[other_tag.id]}selected_tags[tag.id]=true;this.setState({selected_tags:selected_tags});return typeof(base=this.props).on_select_tags==="function"?base.on_select_tags(selected_tags):void 0},unselect_group:function(group){var base,i,len,ref,selected_tags,tag;selected_tags=$.extend({},this.state.selected_tags);ref=group.tags;for(i=0,len=ref.length;i<len;i++){tag=ref[i];delete selected_tags[tag.id]}this.setState({selected_tags:selected_tags});return typeof(base=this.props).on_select_tags==="function"?base.on_select_tags(selected_tags):void 0},render:function(){var dropdowns;dropdowns=this.props.tag_groups.map(function(_this){return function(group){var options,selected_tag;selected_tag=group.tags.find(function(t){if(_this.state.selected_tags[t.id]){return true}});options=group.tags.map(function(tag){return{name:tag.name,value:tag.id}});if(!options.length){return}options.unshift({name:"Any",value:""});return R.Forms.SimpleSelect({key:group.slug,name:group.slug,value:(selected_tag!=null?selected_tag.id:void 0)||"default",render_current_option:function(current){if(current.value===""){return group.name}else{return strong({},current.name)}},onChange:function(value){var tag;tag=_this.tags_by_id()[value];if(tag){return _this.select_tag(tag.id)}else{return _this.unselect_group(group)}},options:options})}}(this));return this.enclose({},label({},"Filter games"),dropdowns,!$.isEmptyObject(this.state.selected_tags)?div({className:"clear_area"},a({href:"#",onClick:function(_this){return function(e){var base;e.preventDefault();_this.setState({selected_tags:{}});return typeof(base=_this.props).on_select_tags==="function"?base.on_select_tags({}):void 0}}(this)},"Clear filters")):void 0)}})})}).call(this);
